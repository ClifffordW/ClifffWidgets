<!DOCTYPE html>
<html lang="en">
  <body class="loading">
    <!-- Your content here -->
  </body>

  <head>
    <link
      rel="preload"
      href="https://accounts.klei.com/assets/images/background_dark.jpg"
      as="image"
    />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Don't Starve Together Drop</title>
    <link
      rel="icon"
      href="https://clifffordw.github.io/ClifffWidgets/Webpage/dst.ico"
      type="image/x-icon"
    />

    <!-- Open Graph Meta Tags (for Discord, Facebook, etc.) -->
    <meta property="og:title" content="Don't Starve Together Drop" />
    <meta
      property="og:description"
      content="Check out the current drops for Don't Starve Together!"
    />
    <meta
      property="og:image"
      content="https://clifffordw.github.io/ClifffWidgets/Webpage/page_preview2.png"
    />
    <!-- Replace with your image URL -->
    <meta
      property="og:url"
      content="https://clifffordw.github.io/ClifffWidgets/Webpage/index.html"
    />
    <!-- Replace with your webpage URL -->
    <meta property="og:type" content="website" />

    <!-- Twitter Card Meta Tags (for Twitter previews) -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Don't Starve Together Drop" />
    <meta
      name="twitter:description"
      content="Check out the current drops for Don't Starve Together and claim your rewards!"
    />
    <meta
      name="twitter:image"
      content="https://clifffordw.github.io/ClifffWidgets/Webpage/page_preview2.png"
    />
    <!-- Replace with your image URL -->
    <meta
      name="twitter:url"
      content="https://clifffordw.github.io/ClifffWidgets/Webpage/index.html"
    />
    <!-- Replace with your webpage URL -->

    <!-- For Steam Preview (If applicable) -->
    <meta property="og:site_name" content="Don't Starve Together Drop" />
    <meta property="og:locale" content="en_US" />

    <!-- Klei Ambassadors CSS and JS -->
    <link
      href="https://kleiforums.s3.amazonaws.com/ambassadors/streamerslist.css?1"
      rel="stylesheet"
    />
    <script src="https://kleiforums.s3.amazonaws.com/ambassadors/streamerslist.js?1"></script>

    <style>
      /* Font import */
      @font-face {
        font-family: Hammerhead;
        src: url(https://clifffordw.github.io/ClifffWidgets/Fonts/HammerheadBold.ttf);
      }

      /* Global Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Hammerhead, sans-serif;
      }

      body.loading {
        background: #000000;
        /* Temporary background color */
      }

      body {
        background: url("https://accounts.klei.com/assets/images/background_dark.jpg")
          no-repeat center center fixed;
        background-size: cover;
        background-color: #2c2c2c;
        /* Fallback color similar to the image background */
        transition: background 0.3s ease 1s;
      }

      body {
        font-family: Hammerhead, sans-serif;
        background: url("https://accounts.klei.com/assets/images/background_dark.jpg")
          no-repeat center center fixed;
        /*             background: url('https://steamuserimages-a.akamaihd.net/ugc/1773874858626954718/C5E06E4D9614B79735DF657A98F5E55ECC241D44/') no-repeat center center fixed;
 */

        background-size: cover;
        color: #d1d1d1;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100%;
        margin: 0;
        overflow: hidden;
        /* backdrop-filter: blur(8px); */
        position: relative;
      }

      /* Fullscreen Container */
      .container {
        width: 100%;
        height: 100%;
        padding: 40px;
        box-sizing: border-box;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        /*       backdrop-filter: blur(10px); */
        overflow-y: auto;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
      }

      /* Text and Button Styles */
      h1 {
        font-size: 4rem;
        margin-bottom: 30px;
        color: #fff;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
      }

      p {
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
      }

      /* Updated Current Drop Section */
      .drop-info {
        font-size: 2rem;
        /* Make text a bit bigger */
        margin-bottom: 30px;
        color: #ccc;
      }

      .drop-gif {
        width: 100%;
        max-width: 600px;
        margin: 20px auto;
        border-radius: 12px;
      }

      #drop-name {
        font-size: 2rem;
        /* Increase the size of the drop name */
      }

      /* Media Queries for Responsiveness */
      @media (max-width: 768px) {
        .drop-info {
          font-size: 1.6rem;
          /* Adjust for smaller screens */
        }

        #drop-name {
          font-size: 1.8rem;
          /* Adjust the drop name size for mobile */
        }

        .drop-gif {
          max-width: 90%;
          /* Make GIF responsive */
        }
      }

      /* Header Navigation Buttons */
      .header-nav {
        display: flex;
        /* Flexbox for horizontal button arrangement */
        gap: 20px;
        /* Space between buttons */
        margin-bottom: 30px;
        justify-content: center;
      }

      .header-nav:hover {
        display: flex;
        /* Flexbox for horizontal button arrangement */
        gap: 20px;
        /* Space between buttons */
        margin-bottom: 30px;
        justify-content: center;
        filter: saturate(140%) drop-shadow(1px 1px 25px, rgb(255, 0, 0));
      }

      .header-nav button {
        padding: 18px 30px;
        transition: 0.3s ease;

        background: linear-gradient(
          135deg,
          rgba(255, 69, 0, 0.102),
          rgba(255, 72, 0, 0.475)
        );

        color: white;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        font-size: 1.5rem;
        filter: saturate(100%) drop-shadow(1px 1px 5px rgb(255, 72, 0));
      }

      .header-nav button:hover {
        background: linear-gradient(
          135deg,
          rgba(255, 68, 0, 0.322),
          rgba(255, 72, 0, 0.643)
        );
        transform: translateY(-3px);
        filter: saturate(100%) drop-shadow(1px 1px 15px rgb(255, 72, 0));
      }

      #current-drop-btn {
        background: linear-gradient(
          135deg,
          rgba(76, 0, 255, 0.102),
          rgba(144, 0, 255, 0.558)
        );
        filter: saturate(100%) drop-shadow(1px 1px 5px rgb(106, 0, 255));
      }

      #current-drop-btn:hover {
        background: linear-gradient(
          135deg,
          rgba(76, 0, 255, 0.322),
          rgba(110, 0, 255, 0.643)
        );
        filter: saturate(120%) drop-shadow(1px 1px 15px rgb(106, 0, 255));
      }

      .header-nav button.grayscale {
        filter: saturate(0%) brightness(80%);
        pointer-events: none;
      }

      .drop-btns {
        display: flex;
        /* Flexbox for horizontal alignment */
        gap: 40px;
        /* Space between buttons */
        align-items: center;
        /* Center vertically */
        justify-content: center;

        /* Center horizontally */
      }

      .linkacc {
        margin: 15px;
        display: flex;
        align-items: center;
      }

      .linkacc img {
        width: 64px;
        height: 32px;
        vertical-align: middle;
        margin-right: 5px;
      }

      .drop-btns a {
        padding: 18px 30px;
        background: linear-gradient(135deg, #4c00ffdc, #6e00ffab);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        text-decoration: none;
        font-size: 1.5rem;
        text-align: center;
        display: inline-block;
        transition: background-color 0.3s ease, transform 0.3s ease;
      }

      .drop-btns a:hover {
        background-color: #cc5200;
        transform: translateY(-3px);
      }

      /* Footer Styles */
      footer {
        position: absolute;
        bottom: 20px;
        width: 100%;
        text-align: center;
        color: #d1d1d1;
        font-size: 1rem;
        z-index: 5;
      }

      footer img {
        width: 50px;
        vertical-align: middle;
        margin-right: 10px;
      }

      footer a {
        color: #ff6633;
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }

      #widget-drop-preview iframe {
        width: 60%;
        height: 50vh;
        border: none;
      }

      @media (max-width: 768px) {
        #widget-drop-preview iframe {
          width: 100%;
          /* Make the iframe width 100% of the container */
          height: 60vh;
          /* Adjust height as per your preference (use vh for viewport height) */
        }
      }

      /* Media Queries for Responsiveness */
      @media (max-width: 768px) {
        h1 {
          font-size: 2.5rem;
          margin-bottom: 20px;
        }

        .drop-info {
          font-size: 1.4rem;
          margin-bottom: 20px;
        }

        .header-nav {
          flex-direction: column;
          gap: 20px;
        }

        .header-nav button {
          width: 100%;
          font-size: 1.2rem;
          padding: 15px 0;
        }

        .drop-btns {
          flex-direction: column;
          gap: 20px;
        }

        .drop-btns a {
          width: 100%;
          padding: 15px 0;
          font-size: 1.4rem;
        }

        .container {
          padding: 20px;
        }
      }

      @media (max-width: 480px) {
        h1 {
          font-size: 2rem;
        }

        .drop-info {
          font-size: 1.2rem;
        }

        .header-nav button {
          font-size: 1.1rem;
          padding: 12px 0;
        }

        .drop-btns a {
          font-size: 1.3rem;
        }

        .container {
          padding: 15px;
        }
      }

      #timer {
        font-size: 1.2em;
        font-weight: bold;
        color: #ff5722;
        margin-top: 10px;
      }

      /* Initially hide both sections */
      .hidden {
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <!-- Header Navigation -->
      <div class="header-nav">
        <button id="current-drop-btn" class="dropbtn">Current Drop</button>

        <button id="ambassadors-btn">Klei Ambassadors</button>
        <button id="widget-drop-btn">Ambassador's Widget</button>

        <button id="redeemables-btn">Redeemables</button>
      </div>

      <!-- Current Drop Section -->
      <!-- Current Drop Section -->
      <div id="current-drop" class="drop-info hidden">
        <div id="timer">Time remaining: 5d 3h 45m 12s</div>
        <h1>Don't Starve Together</h1>
        <p>
          Get your exclusive drops for Don't Starve Together! <br />Check out
          the current drop below and claim your reward!
        </p>

        <!-- Move the drop details below the GIF -->
        <div>
          <img id="drop-gif" class="drop-gif" src="" alt="Current Drop GIF" />

          <div class="drop-btns">
            <div class="linkacc">
              <a
                href="https://accounts.klei.com/account/twitch/link"
                target="_blank"
                >Link Your
                <img
                  src="https://blog.logomyway.com/wp-content/uploads/2021/03/Twitch-logo-PNG.png"
                  alt="Twitch Logo"
                  width="128"
                  height="64"
                />Account
              </a>
            </div>
          </div>
        </div>

        <div>
          <p><b>Current Drop:</b> <span id="drop-name">Loading...</span></p>
        </div>

        <div id="drop-info" class="drop-info-text horizontal-timers">
          <!-- Drop details will be inserted here -->
        </div>
      </div>

      <div id="redeemables" class="redeemables hidden">
        <h1>Spools'n'Points</h1>
        <h2>Get your links for points and spools!</h2>

        <div class="point-btns">
          <div class="spoolspoints">
            <a
              href="https://steamcommunity.com/sharedfiles/filedetails/?id=2308653652"
              target="_blank"
            >
              <img
                src="https://cdn.freebiesupply.com/logos/large/2x/steam-1-logo-black-and-white.png"
                alt="Steam Logo"
                width="128"
                height="128"
              />
            </a>
          </div>

          <div class="spoolspoints_forums">
            <a
              href="https://forums.kleientertainment.com/forums/topic/119013-free-spools-and-points/"
              target="_blank"
            >
              <img
                src="https://support.klei.com/hc/theming_assets/01HZPD6TCSEKT66X1B1ASZBB0B"
                alt="Klei Logo"
                width="128"
                height="128"
              />
            </a>
          </div>
        </div>
      </div>

      <style>
        .spoolspoints {
          position: flex;
          align-items: center;
        }

        .spoolspoints a {
          padding: 18px 30px;
          /*                 background: linear-gradient(6deg, #ffbb00d2 2%, #c70505c4 150%);
 */
          color: white;
          border: none;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          text-decoration: none;
          font-size: 1.5rem;
          text-align: center;
          display: inline-block;
          /*                 transition: background-color 0.3s ease, transform 0.3s ease;

 */
          transition: 0.3s ease;
          margin: 15px;
          filter: invert(1);
        }

        .spoolspoints a:hover {
          /*                 background-color: #ff0000;
 */
          transform: translateY(-6px) scale(1.06);
        }

        .point-btns {
          display: flex;
          justify-content: center;
        }

        .spoolspoints_forums a {
          padding: 18px 30px;
          /*                 background: linear-gradient(6deg, #ffbb00d2 2%, #c70505c4 150%);
 */
          color: white;
          border: none;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          text-decoration: none;
          font-size: 1.5rem;
          text-align: center;
          display: inline-block;
          transition: background-color 0.3s ease, transform 0.3s ease;
          margin: 15px;
        }

        .spoolspoints_forums a:hover {
          /*                 background-color: #ff0000;
 */
          transform: translateY(-6px) scale(1.06);
        }
      </style>

      <div id="ambassadors-section" class="hidden">
        <!-- The list of streams will be injected here -->
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", (event) => {
          const img = new Image();
          img.src =
            "https://accounts.klei.com/assets/images/background_dark.jpg";
          img.onload = () => {
            setTimeout(() => {
              document.body.classList.remove("loading");
            }, 1000); // 1-second delay
          };
        });

        document.addEventListener("DOMContentLoaded", async function () {
          try {
            // Fetch the JSON data
            const response = await fetch(
              "https://kleiforums.s3.amazonaws.com/gameimages/amblist.json"
            );
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            // Select the div to display the streams
            const streamListDiv = document.getElementById(
              "ambassadors-section"
            );

            // Generate HTML for each stream
            const streamHTML = data
              .map((stream) => {
                // Modify the ThumbnailURL to use 1920x1080 instead of 440x248
                let thumbnailURL = stream.ThumbnailURL;

                // Check if the URL contains '440x248' and replace it with '1920x1080'
                if (thumbnailURL.includes("440x248")) {
                  thumbnailURL = thumbnailURL.replace("440x248", "1920x1080");
                }

                return `
                                <div class="stream">
                                    <img class="profile-icon" src="${stream.ProfileIcon}" alt="${stream.Name}'s profile icon">
                                    <div class="stream-details">
                                        <h2>${stream.Name}</h2>
                                        <p><b>Title:</b> ${stream.Title}</p>
                                        <p><b>Game:</b> ${stream.Game}</p>
                                        <div class="stream-watch">
                                            <a href="${stream.StreamURL}" target="_blank">Watch Stream</a>
                                        </div>
                                    </div>
                                    <!-- Use the modified thumbnail URL here -->
                                    <img class="thumbnail" src="${thumbnailURL}" alt="${stream.Name}'s thumbnail">
                                </div>
                            `;
              })
              .join("");

            // Inject the generated HTML into the div
            streamListDiv.innerHTML = streamHTML;
          } catch (error) {
            console.error("Error fetching or parsing JSON:", error);
          }
        });
      </script>

      <style>
        .stream {
          display: flex;
          align-items: center;
          margin: 20px 0;
          border: 3px solid #ddd;
          border-image: linear-gradient(to right, #ff45001a 25%, #6e00ffab 75%)
            1;
          padding: 10px;
          border-radius: 8px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          background: linear-gradient(135deg, #ff45001a, #6e00ffab);
          /* backdrop-filter: blur(15px); */
          transition: 0.5s;
        }

        .stream:hover {
          background: linear-gradient(135deg, #ff45001a, #ff6a00ab);

          scale: 102%;
        }

        .stream:hover .thumbnail {
          filter: drop-shadow(0 0 5rem purple);
          margin-top: 6px;
        }

        .thumbnail_bg {
          background-repeat: no-repeat;
          background-size: cover;
        }

        .stream-watch {
          font-size: 1.2em;
          transition: 0.25s;
        }

        .stream:hover .stream-watch {
          scale: 150%;
          filter: drop-shadow(0 0 0.5rem rgb(212, 67, 0));
        }

        .profile-icon {
          width: 128px;
          height: auto;
          border-radius: 0%;
          margin-right: 15px;
        }

        .thumbnail {
          width: 25%;
          height: auto;
          margin-left: 15px;
          border-radius: 4px;
          transition: 0.5s;
          z-index: 5;
        }

        .stream-details {
          flex-grow: 1;
          color: #e77137;
          font-size: 1.2em;
        }

        .stream-details h2 {
          margin: 0;
        }

        .stream-details p {
          margin: 5px 0;
          color: white;
        }

        .stream-details a {
          display: inline-block;
          margin-top: 10px;
          text-decoration: none;
          color: #ff6200;
          font-weight: bold;
        }

        .stream-details a:hover {
          text-decoration: underline;
        }
      </style>

      <style>
        /* Flex container for horizontal alignment */
        .horizontal-timers {
          display: flex;
          flex-wrap: wrap;
          gap: 45px;
          /* Space between items */
          justify-content: center;
          /* Center-align items horizontally */
          color: white;
        }

        /* Individual timer block styling */
        .horizontal-timers p {
          /* backdrop-filter: blur(30px); */
          background: linear-gradient(
            135deg,
            #c058177e,
            rgba(180, 100, 19, 0.22)
          );
          border: 1px solid #252525;
          border-radius: 8px;
          text-align: center;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          font-size: 1rem;
          min-width: 120px;
          /* Ensure consistent width */
          scale: 125%;
        }

        .horizontal-timers {
          position: relative;
          top: 5px;
        }

        .ambasadorname {
          color: #fff;
          font-size: 4rem;
        }

        .ambasadorname_text {
          font-size: 2.1rem;
        }
      </style>

      <!-- Widget Drop Preview Section -->
      <!-- Widget Drop Preview Section -->
      <div id="widget-drop-preview" class="hidden">
        <div class="ambasadorname">
          <h2>Ambassador's Widget</h2>
        </div>
        <div class="ambasadorname_text">
          <p>
            If you are interested in using the widget, you can contact me on
            Discord: <b>zero2su</b>.
          </p>
        </div>

        <!-- Input for Twitch Username -->
        <div class="widget-input-container">
          <input
            type="text"
            id="twitch-username-input"
            placeholder="Enter your Twitch username (lowercase)"
          />
          <button onclick="loadWidget()">Load Widget</button>
        </div>

        <!-- Status Message -->
        <div id="widget-status" class="widget-status"></div>

        <!-- Buttons for Copying CSS and HTML -->
        <div id="copy-buttons-container" class="hidden">
          <button onclick="copySingularDropCSS()">
            Copy Singular Drop CSS
          </button>
          <button onclick="copyDropHTML()">Copy Drop HTML</button>
        </div>

        <!-- Iframe for Widget Preview -->
        <iframe
          id="widget-iframe"
          src=""
          frameborder="0"
          class="hidden"
        ></iframe>
      </div>

      <!-- Styles for the Input, Buttons, and Status Message -->
      <style>
        .widget-input-container {
          margin: 20px 0;
          display: flex;
          justify-content: center;
          gap: 10px;
          font-size: 1.2rem;
        }

        #twitch-username-input {
          padding: 10px;
          font-size: 1rem;
          border: 2px solid #ccc;
          border-radius: 8px;
          width: 300px;
          max-width: 80%;
        }

        #twitch-username-input::placeholder {
          color: #999;
        }

        .widget-input-container button {
          padding: 10px 20px;
          background: linear-gradient(135deg, #4c00ffdc, #6e00ffab);
          color: white;
          border: none;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          transition: background-color 0.3s ease, transform 0.3s ease;
        }

        .widget-input-container button:hover {
          background: linear-gradient(135deg, #4c00ffab, #6e00ffdc);
          transform: translateY(-2px);
        }

        .widget-status {
          margin-top: 10px;
          text-align: center;
          font-size: 1.6rem;
          color: #ff5722;
        }

        #copy-buttons-container {
          margin-top: 20px;
          text-align: center;
          display: flex;
          justify-content: center;
          gap: 10px;
        }

        #copy-buttons-container button {
          font-size: 1.2rem;
          padding: 10px 20px;
          background: linear-gradient(135deg, #ff4500dc, #ff6a00ab);
          color: white;
          border: none;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          transition: background-color 0.3s ease, transform 0.3s ease;
        }

        #copy-buttons-container button:hover {
          background: linear-gradient(135deg, #ff4400ab, #ff6a00dc);
          transform: translateY(-2px);
        }

        /* Ensure elements with the 'hidden' class are hidden */
        .hidden {
          display: none !important;
        }
      </style>

      <!-- Script to Handle Input, Load Widget, and Copy CSS/HTML -->
      <script>
        async function loadWidget() {
          const input = document.getElementById("twitch-username-input");
          const iframe = document.getElementById("widget-iframe");
          const status = document.getElementById("widget-status");
          const copyButtonsContainer = document.getElementById(
            "copy-buttons-container"
          );

          // Ensure the input value is lowercase
          const username = input.value.toLowerCase();

          if (!username) {
            status.textContent = "Please enter a valid Twitch username.";
            copyButtonsContainer.classList.add("hidden"); // Hide the copy buttons
            iframe.classList.add("hidden"); // Hide the iframe
            return;
          }

          // Construct the widget URL
          const widgetUrl = `https://clifffordw.github.io/ClifffWidgets/Drops/Streamers/${username}.html`;

          // Check if the widget exists
          try {
            const response = await fetch(widgetUrl, { method: "HEAD" });
            if (response.ok) {
              // Widget exists: Load it in the iframe
              iframe.src = widgetUrl;
              iframe.classList.remove("hidden"); // Show the iframe
              status.textContent = "Widget loaded!";
              copyButtonsContainer.classList.remove("hidden"); // Show the copy buttons
            } else {
              // Widget does not exist
              iframe.src = ""; // Clear the iframe
              iframe.classList.add("hidden"); // Hide the iframe
              status.textContent = "Widget not found.";
              copyButtonsContainer.classList.add("hidden"); // Hide the copy buttons
            }
          } catch (error) {
            console.error("Error checking widget URL:", error);
            status.textContent = "An error occurred. Please try again.";
            copyButtonsContainer.classList.add("hidden"); // Hide the copy buttons
            iframe.classList.add("hidden"); // Hide the iframe
          }
        }

        async function copySingularDropCSS() {
          const css = `
            /* Singular Drop Shown */

            .bg-flair,
            .bg-portrait {
            display: none !important;
            }

            .bg-item {
            width: 60% !important;
            height: auto !important;
            margin-top: 100px !important;
            margin-left: 80px !important;
            }

            .item-frame {
            width: 90% !important;
            }

        `;

          // Copy the CSS to the clipboard
          try {
            await navigator.clipboard.writeText(css.trim());
            document.getElementById("widget-status").textContent =
              "Singular Drop CSS copied to clipboard! 1024x1024 (Custom CSS Box)";
          } catch (error) {
            console.error("Failed to copy CSS:", error);
            document.getElementById("widget-status").textContent =
              "Failed to copy CSS. Please try again.";
          }
        }

        async function copyDropHTML() {
          const iframe = document.getElementById("widget-iframe");
          const widgetUrl = iframe.src;

          if (!widgetUrl) {
            document.getElementById("widget-status").textContent =
              "No widget loaded. Please load a widget first.";
            return;
          }

          // Construct the HTML to copy
          const html = `
          
            ${widgetUrl}
     
        `;

          // Copy the HTML to the clipboard
          try {
            await navigator.clipboard.writeText(html.trim());
            document.getElementById("widget-status").textContent =
              "Drop HTML copied to clipboard! 1024x512";
          } catch (error) {
            console.error("Failed to copy HTML:", error);
            document.getElementById("widget-status").textContent =
              "Failed to copy HTML. Please try again.";
          }
        }
      </script>

      <style>
        footer {
          background-color: rgba(0, 0, 0, 0.7);
          /* Semi-transparent black background */
          /* backdrop-filter: blur(10px); */
          /* Apply blur effect to the background */
          color: white;
          /* White text color for better contrast */
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 10px 20px;
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          z-index: 10;
          /* Ensure it's on top of other elements */
        }

        footer span {
          font-size: 14px;
          line-height: 1.5;
          display: flex;
          align-items: center;
          /* Align text and logo vertically */
          justify-content: center;
        }

        .footer-logo {
          width: 20px;
          /* Adjust the logo size */
          height: auto;
          margin: 0 5px;
          /* Space between the logo and text */
        }

        footer a {
          color: #ffcc66;
          /* Light orange for the link */
          text-decoration: none;
        }

        footer a:hover {
          text-decoration: underline;
          color: #ffe680;
          /* Brighten the link color on hover */
        }
      </style>

      <audio
        id="electricity-sound"
        src="https://clifffordw.github.io/ClifffWidgets/Webpage/BLACKOUT_OFF.wav"
        preload="auto"
      ></audio>

      <script>
        // Fetch the current campaign drop details
        // Fetch the current campaign drop details
        fetch("https://cdn.forums.klei.com/drops/current_campaign.json")
          .then((response) => response.json())
          .then((data) => {
            const dropName = data["Don't Starve Together"]["englishName"];
            const dropGif = data["Don't Starve Together"]["gif"];
            const campaignEnd = data["Don't Starve Together"]["campaignEnd"];
            const campaignStart =
              data["Don't Starve Together"]["campaignStart"];

            const campaignStartDate = new Date(campaignStart * 1000);

            const campaignEndDate = new Date(campaignEnd * 1000); // Convert Unix timestamp to Date
            const currentDate = new Date();

            function requestNotificationPermission() {
              if (Notification.permission === "granted") {
                console.log("Notification permission already granted.");
              } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then((permission) => {
                  if (permission === "granted") {
                    console.log("Notification permission granted.");
                  } else {
                    console.log("Notification permission denied.");
                  }
                });
              }
            }

            function hasUserBeenNotified(dropName) {
              const notifiedDrops = JSON.parse(
                localStorage.getItem("notifiedDrops") || "{}"
              );
              return notifiedDrops[dropName] === true;
            }

            function markUserAsNotified(dropName) {
              const notifiedDrops = JSON.parse(
                localStorage.getItem("notifiedDrops") || "{}"
              );
              notifiedDrops[dropName] = true;
              localStorage.setItem(
                "notifiedDrops",
                JSON.stringify(notifiedDrops)
              );
            }

            function notifyUser(title, message, dropName) {
              if (hasUserBeenNotified(dropName)) {
                console.log("User has already been notified about this drop.");
                return;
              }

              if (Notification.permission === "granted") {
                const notification = new Notification(title, {
                  body: message,
                  icon: "path/to/icon.png",
                  requireInteraction: true,
                });

                markUserAsNotified(dropName); // Mark as notified when the notification is shown
              } else {
                console.log("Notification permission not granted.");
              }
            }

            function checkForLiveDrops() {
              if (currentDate >= campaignStartDate) {
                // Drop has started
                notifyUser(
                  "Drop Started!",
                  `The drop "${dropName}" is now live.`
                );
              } else {
                // Drop has not started yet
                const timeUntilStart = campaignStartDate - currentDate;
                setTimeout(() => {
                  notifyUser(
                    "Drop Started!",
                    `The drop "${dropName}" is now live.`
                  );
                }, timeUntilStart);
              }
            }

            // Request notification permission when the user interacts with the page
            document.addEventListener("DOMContentLoaded", () => {
              requestNotificationPermission();
              checkForLiveDrops(); // Initial check
              setInterval(checkForLiveDrops, 60000); // Poll every 60 seconds
            });

            // Check if the campaign has ended
            if (currentDate > campaignEndDate) {
              // Campaign has ended, show "Widget Drop Preview"
              document.getElementById("drop-name").textContent =
                "Current drop unavailable";
              document.getElementById("drop-gif").style.display = "none";
              document.querySelector(".drop-btns").style.display = "none";
              document.getElementById("current-drop-btn").textContent =
                "Drop Unavailable";
              document
                .getElementById("current-drop-btn")
                .classList.add("grayscale");

              currentDropSection.classList.add("hidden");
              ambassadorsSection.classList.remove("hidden");
              widgetDropPreviewSection.classList.add("hidden");
              document.getElementById("current-drop-btn").style.filter =
                "grayscale(100%)";
            } else {
              // Campaign is still active, show "Current Drop"
              document.getElementById("drop-name").textContent = dropName;
              document.getElementById("drop-gif").src = dropGif;
              document.getElementById("drop-gif").style.display = "block";
              document.querySelector(".drop-btns").style.display = "block";
              document.getElementById("current-drop-btn").textContent =
                dropName;
              document
                .getElementById("current-drop-btn")
                .classList.remove("grayscale");
              currentDropSection.classList.remove("hidden");
              widgetDropPreviewSection.classList.add("hidden");
              ambassadorsSection.classList.add("hidden");

              // Drop details in minutes
              const dropDetails = [
                { time: 30, reward: "Profile Flair" },
                { time: 90, reward: "Portrait" },
                { time: 180, reward: dropName }, // Use the dynamically set item name
              ];

              // Filter out the first 20 minutes and keep time in minutes
              const formattedDetails = dropDetails
                .filter((detail) => detail.time > 20)
                .map((detail) => {
                  return `<p>${detail.time} minutes: <br><b>${detail.reward}</b></p>`;
                });

              // Inject into the #drop-info div
              const dropInfoDiv = document.getElementById("drop-info");
              dropInfoDiv.innerHTML = formattedDetails.join("");

              // Timer logic
              const timerElement = document.getElementById("timer");

              function updateTimer() {
                const currentDate = new Date(); // Get the updated current date and time
                const timeRemaining = campaignEndDate - currentDate; // Calculate time remaining in milliseconds

                if (timeRemaining < 0) {
                  // Calculate days, hours, minutes, and seconds
                  const days = Math.floor(
                    timeRemaining / (1000 * 60 * 60 * 24)
                  );
                  const hours = Math.floor(
                    (timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
                  );
                  const minutes = Math.floor(
                    (timeRemaining % (1000 * 60 * 60)) / (1000 * 60)
                  );
                  const seconds = Math.floor(
                    (timeRemaining % (1000 * 60)) / 1000
                  );

                  // Update the timer display
                  timerElement.innerHTML = `
                    Time remaining: ${days}d ${hours}h ${minutes}m ${seconds}s
                `;
                } else {
                  // Timer has ended
                  timerElement.innerHTML = "Time's up!"; // Optional: Display a message
                  timerElement.style.display = "none"; // Hide the timer

                  // Mark the campaign as unavailable
                  document.getElementById("drop-name").textContent =
                    "Current drop unavailable";
                  document.getElementById("drop-gif").style.display = "none";
                  document.querySelector(".drop-btns").style.display = "none";

                  document.getElementById("current-drop-btn").style.filter =
                    "grayscale(100%)";

                  document.getElementById("current-drop-btn").textContent =
                    "Drop Unavailable";
                  document
                    .getElementById("current-drop-btn")
                    .classList.add("grayscale");
                  currentDropSection.classList.add("hidden");
                  ambassadorsSection.classList.remove("hidden");
                  widgetDropPreviewSection.classList.add("hidden");
                }
              }

              // Start the timer
              updateTimer(); // Initial call to avoid delay
              setInterval(updateTimer, 1000); // Update every second
            }
          })
          .catch((error) => {
            console.error("Error fetching drop data:", error);
            document.getElementById("drop-name").textContent =
              "Error loading drop information";
          });

        // Handle button clicks to toggle visibility between sections
        let currentDropSection = document.getElementById("current-drop");
        let widgetDropPreviewSection = document.getElementById(
          "widget-drop-preview"
        );
        let redeemableSection = document.getElementById("redeemables");

        document.getElementById("current-drop-btn").onclick = function () {
          currentDropSection.classList.remove("hidden");
          widgetDropPreviewSection.classList.add("hidden");
          ambassadorsSection.classList.add("hidden");
          redeemableSection.classList.add("hidden");
        };

        document.getElementById("widget-drop-btn").onclick = function () {
          widgetDropPreviewSection.classList.remove("hidden");
          currentDropSection.classList.add("hidden");
          ambassadorsSection.classList.add("hidden");
          redeemableSection.classList.add("hidden");
        };

        document.getElementById("redeemables-btn").onclick = function () {
          widgetDropPreviewSection.classList.add("hidden");
          currentDropSection.classList.add("hidden");
          ambassadorsSection.classList.add("hidden");
          redeemableSection.classList.remove("hidden");
        };

        // Get reference to the Ambassadors section
        let ambassadorsSection = document.getElementById("ambassadors-section");

        // Handle Ambassadors button click
        document.getElementById("ambassadors-btn").onclick = function () {
          ambassadorsSection.classList.remove("hidden");
          currentDropSection.classList.add("hidden");
          widgetDropPreviewSection.classList.add("hidden");
          redeemableSection.classList.add("hidden");
        };
      </script>
    </div>

    <footer>
      <span>
        I am not affiliated with
        <img
          src="https://support.klei.com/hc/theming_assets/01HZPD6TCSEKT66X1B1ASZBB0B"
          alt="Klei Entertainment Logo"
          class="footer-logo"
        />
        Skin data is provided by Klei's API.
        <a href="https://www.klei.com/" target="_blank"
          >Visit Klei Entertainment</a
        >
      </span>
    </footer>
  </body>
</html>
